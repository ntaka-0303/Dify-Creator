# Difyアプリテンプレート

このガイドは、Dify公式から提供されている5つのDSLテンプレートを選択し理解するのに役立ちます。

## 目次
- テンプレート概要と選択ガイド
- 各テンプレートの詳細説明
- カスタマイズガイダンス
- ベストプラクティス

---

## クイック選択ガイド

| テンプレート | アプリモード | 使用例 | 最適な用途 |
|----------|----------|-----------|----------|
| **DeepResearch** | advanced-chat | 深い調査、複数トピックの研究 | 研究アシスタント、詳細調査 |
| **ウェブの検索と要約のワークフローパターン** | workflow | Web検索、コンテンツ要約 | 情報収集、要約タスク |
| **投資分析レポート コパイロット** | agent-chat | 株価分析、投資レポート作成 | 金融分析、市場調査 |
| **知識リトリーバル + チャットボット** | advanced-chat | ドキュメント検索、Q&A | ヘルプデスク、知識ベース |
| **質問分類器 + 知識 + チャットボット** | advanced-chat | 質問振り分け、適切な回答提供 | カスタマーサポート、FAQ |

---

## テンプレート 1：DeepResearch

### 機能
複数のトピックを深く調査し、包括的な研究結果を提供する高度なチャットボット。

### 最適な用途
- 研究アシスタント
- 複数トピックの詳細調査
- 包括的なレポート作成
- 知見の体系的な収集

### 主な特徴
- **モード：** `advanced-chat`（高度な対話型）
- **会話変数：** topics（トピックリスト）、findings（調査結果）、shouldContinue（継続フラグ）
- **複雑度：** ⭐⭐⭐⭐ 高度
- **ファイルアップロード：** 対応（画像、ドキュメント等）

### 使用シナリオ

**例1：市場調査**
```
ユーザー：「AI業界の最新トレンドを調査して」
→ 複数のトピックを自動生成し、順次調査
→ 各トピックの調査結果を蓄積
→ 包括的な分析結果を提供
```

**例2：学術研究**
```
ユーザー：「量子コンピューティングの応用分野を調べて」
→ 関連トピックを特定（医療、暗号、最適化等）
→ 各分野の最新研究を調査
→ 統合されたレポートを生成
```

---

## テンプレート 2：ウェブの検索と要約のワークフローパターン

### 機能
Web検索を実行し、結果を要約して提示するワークフロー。Tavily検索API、Jina Reader、OpenAIモデルを統合。

### 最適な用途
- リアルタイム情報検索
- Webコンテンツの要約
- ニュース収集と整理
- 競合分析

### 主な特徴
- **モード：** `workflow`（プロセスベース）
- **統合プラグイン：**
  - Tavily（Web検索）
  - Jina Tool（コンテンツ抽出）
  - OpenAI（要約生成）
- **複雑度：** ⭐⭐⭐ 中～高

### ワークフロー構造

```
1. 検索クエリを受け取る
2. Tavily APIでWeb検索を実行
3. Jina Toolで関連コンテンツを抽出
4. OpenAIで要約を生成
5. 構造化された結果を返す
```

### 使用シナリオ

**例1：ニュースモニタリング**
```
入力：「最新のAI規制に関するニュース」
→ Web検索実行
→ 関連記事を抽出
→ 重要ポイントを要約
出力：構造化されたニュース要約
```

**例2：競合調査**
```
入力：「競合他社の新製品情報」
→ 複数ソースから情報収集
→ 製品特徴を抽出
→ 比較可能な形式で要約
```

---

## テンプレート 3：投資分析レポート コパイロット

### 機能
Yahoo Finance APIを活用し、株価分析、ニュース収集、トレンド分析を行うエージェントチャットボット。

### 最適な用途
- 株価分析
- 投資レポート作成
- 市場トレンド調査
- ポートフォリオ分析

### 主な特徴
- **モード：** `agent-chat`（エージェント型）
- **ツール統合：**
  - Yahoo Finance Analytics（価格分析）
  - Yahoo Finance News（ニュース取得）
  - Yahoo Finance Ticker（銘柄情報）
- **エージェント設定：**
  - 最大反復：5回
  - 戦略：function_call
- **複雑度：** ⭐⭐⭐⭐ 高度

### 使用シナリオ

**例1：個別銘柄分析**
```
ユーザー：「AAPLの直近1ヶ月の分析をして」
→ 株価データ取得（Analytics）
→ 関連ニュース収集（News）
→ トレンド分析
→ 総合レポート生成
```

**例2：ポートフォリオ評価**
```
ユーザー：「AAPL、GOOGL、MSFTの比較分析」
→ 各銘柄のデータ取得
→ パフォーマンス比較
→ 投資推奨の提供
```

---

## テンプレート 4：知識リトリーバル + チャットボット

### 機能
ナレッジベースから関連情報を検索し、文脈に基づいた回答を提供する高度なチャットボット。

### 最適な用途
- 社内ヘルプデスク
- 製品ドキュメントQ&A
- 技術サポート
- FAQ自動応答

### 主な特徴
- **モード：** `advanced-chat`（高度な対話型）
- **知識検索：** Knowledge Retrievalノード搭載
- **ワークフロー：** Start → Knowledge Retrieval → LLM → Answer
- **複雑度：** ⭐⭐⭐ 中～高

### ワークフロー構造

```
1. ユーザーの質問を受け取る
2. ナレッジベースから関連情報を検索
3. 検索結果を文脈として使用
4. LLMで適切な回答を生成
5. 根拠となる情報源とともに回答
```

### 使用シナリオ

**例1：製品サポート**
```
ユーザー：「パスワードのリセット方法は？」
→ ドキュメントから関連手順を検索
→ 具体的な手順を回答
→ 参照元ドキュメントも提示
```

**例2：社内FAQ**
```
ユーザー：「経費申請の承認プロセスは？」
→ 社内規程から関連情報を抽出
→ わかりやすく説明
→ 必要なフォームへのリンクも提供
```

---

## テンプレート 5：質問分類器 + 知識 + チャットボット

### 機能
質問を自動分類し、適切な知識ソースから回答を生成する高度なチャットボット。

### 最適な用途
- 複数部門のカスタマーサポート
- マルチカテゴリFAQ
- 問い合わせトリアージ
- インテリジェントルーティング

### 主な特徴
- **モード：** `advanced-chat`（高度な対話型）
- **質問分類：** 自動カテゴリ判定
- **条件分岐：** カテゴリ別の処理パス
- **知識統合：** カテゴリ別ナレッジベース
- **複雑度：** ⭐⭐⭐⭐ 高度

### ワークフロー構造

```
1. ユーザーの質問を受け取る
2. 質問を分類（技術、請求、一般等）
3. カテゴリに応じた知識ソースを選択
4. 適切な回答スタイルで応答
5. 必要に応じてエスカレーション
```

### 使用シナリオ

**例1：マルチサポート**
```
ユーザー：「製品が起動しません」
→ 分類：技術サポート
→ 技術ナレッジベースから検索
→ トラブルシューティング手順を提供

ユーザー：「請求書を再発行して」
→ 分類：請求関連
→ 請求ナレッジベースから検索
→ 再発行プロセスを案内
```

**例2：エスカレーション**
```
ユーザー：「クレームを申し立てたい」
→ 分類：クレーム・高優先度
→ 専門チームへの転送を提案
→ 必要情報の事前収集
```

---

## テンプレート選択の判定フロー

```
開始：「Difyアプリを構築したい」
  │
  ├─ 「深い調査や研究が必要？」
  │  └─ はい → DeepResearchを使用
  │
  ├─ 「Web検索と要約が中心？」
  │  └─ はい → ウェブの検索と要約のワークフローパターンを使用
  │
  ├─ 「金融・投資データ分析？」
  │  └─ はい → 投資分析レポート コパイロットを使用
  │
  ├─ 「ナレッジベースから情報検索？」
  │  ├─ シンプルなQ&A → 知識リトリーバル + チャットボットを使用
  │  └─ 質問分類が必要 → 質問分類器 + 知識 + チャットボットを使用
```

---

## カスタマイズガイダンス

### すべてのテンプレートの共通カスタマイズ

1. **基本情報の更新**
```yaml
app:
  name: "あなたのアプリ名"
  description: "アプリの説明"
  icon: "🤖"  # 適切なアイコンに変更
  icon_background: "#FFEAD5"  # 背景色をカスタマイズ
```

2. **モデル設定のカスタマイズ**
- プロバイダー選択（OpenAI、Anthropic等）
- モデル選択（GPT-4、Claude等）
- パラメータ調整（temperature、max_tokens等）

3. **プロンプトの調整**
- システムプロンプトで役割と制約を定義
- トーンとスタイルの調整
- 出力形式の指定

### テンプレート別カスタマイズポイント

**DeepResearch**
- 調査するトピック数の制限
- 各トピックの深さの調整
- 継続条件のカスタマイズ

**ウェブの検索と要約**
- 検索ソースの追加/変更
- 要約の詳細度調整
- フィルタリング条件の設定

**投資分析コパイロット**
- 分析期間の設定
- 使用する指標のカスタマイズ
- レポート形式の調整

**知識リトリーバル系**
- ナレッジベースの接続
- 検索パラメータの調整
- 回答スタイルの設定

---

## ベストプラクティス

### すべきこと ✅

- 最も近いユースケースのテンプレートで開始
- 段階的にカスタマイズ（一度に多くを変更しない）
- テストデータで十分に検証
- ナレッジベースは適切に構造化
- エラーハンドリングを考慮
- ユーザーフィードバックを収集

### してはいけないこと ❌

- テンプレートの基本構造を大きく変更
- 検証なしでプロダクション環境へデプロイ
- APIキーや認証情報をハードコード
- 無制限のループや反復を設定
- 適切なエラーメッセージなしで失敗させる

---

## 次のステップ

1. **テンプレートを選択** 上記のガイドから
2. **テンプレートファイルを確認** `examples/templates/`で
3. **ローカルでテスト** 検証とテスト実行
4. **カスタマイズ** 具体的なニーズに合わせて
5. **反復改善** フィードバックに基づいて調整
6. **デプロイ** Difyにアップロード

完全なアプリ作成と反復ワークフローについては[workflows.md](../core/workflows.md)を参照してください。
