version: "0.5.0"
kind: app

metadata:
  name: "Conditional Workflow"
  description: "æ¡ä»¶åˆ†å²ã‚’å«ã‚€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"
  icon: "ğŸ”€"
  icon_background: "#fef3f0"

app:
  name: "Conditional Workflow"
  mode: "workflow"
  description: "æ¡ä»¶åˆ†å²ã‚’å«ã‚€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"
  icon: "ğŸ”€"
  icon_background: "#fef3f0"

workflow:
  variable_pool:
    - variable_name: "input_text"
      type: "string"
      description: "å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ"
      value: ""

    - variable_name: "sentiment"
      type: "string"
      description: "æ„Ÿæƒ…åˆ†æçµæœ"
      value: ""

  nodes:
    - id: "start"
      title: "é–‹å§‹"
      type: "start"
      position:
        x: 100
        y: 100
      data: {}

    - id: "sentiment-llm"
      title: "æ„Ÿæƒ…åˆ†æ"
      type: "llm"
      position:
        x: 300
        y: 100
      data:
        provider_name: "anthropic"
        model_name: "claude-3-5-sonnet-20241022"
        temperature: 0.3
        max_tokens: 100
        prompt_template: |
          Analyze the sentiment of the following text.
          Respond with ONLY one word: positive, negative, or neutral.

          Text: {{input_text}}
        variables:
          - name: "input_text"
            type: "string"
            required: true
        outputs:
          - name: "text"
            type: "string"

    - id: "if-node"
      title: "æ„Ÿæƒ…åˆ¤å®š"
      type: "if_else"
      position:
        x: 500
        y: 100
      data:
        conditions:
          - variable: "sentiment-llm.text"
            operator: "is"
            value: "positive"
            logic: "and"
        output_name: "is_positive"

    - id: "positive-response"
      title: "ãƒã‚¸ãƒ†ã‚£ãƒ–å¿œç­”"
      type: "llm"
      position:
        x: 600
        y: 50
      data:
        provider_name: "anthropic"
        model_name: "claude-3-5-sonnet-20241022"
        temperature: 0.7
        max_tokens: 500
        prompt_template: |
          The user provided positive feedback: {{input_text}}

          Please provide an encouraging response.
        variables:
          - name: "input_text"
            type: "string"
            required: true
        outputs:
          - name: "text"
            type: "string"

    - id: "negative-response"
      title: "ãƒã‚¬ãƒ†ã‚£ãƒ–å¿œç­”"
      type: "llm"
      position:
        x: 600
        y: 150
      data:
        provider_name: "anthropic"
        model_name: "claude-3-5-sonnet-20241022"
        temperature: 0.7
        max_tokens: 500
        prompt_template: |
          The user provided negative feedback: {{input_text}}

          Please address their concerns and provide a helpful response.
        variables:
          - name: "input_text"
            type: "string"
            required: true
        outputs:
          - name: "text"
            type: "string"

    - id: "end"
      title: "çµ‚äº†"
      type: "end"
      position:
        x: 800
        y: 100
      data:
        outputs:
          - variable: "response"

  connections:
    - source:
        node_id: "start"
        output: "output"
      target:
        node_id: "sentiment-llm"
        input_from: "context"

    - source:
        node_id: "sentiment-llm"
        output: "text"
      target:
        node_id: "if-node"
        input_from: "condition"

    - source:
        node_id: "if-node"
        output: "true"
      target:
        node_id: "positive-response"
        input_from: "input"

    - source:
        node_id: "if-node"
        output: "false"
      target:
        node_id: "negative-response"
        input_from: "input"

    - source:
        node_id: "positive-response"
        output: "text"
      target:
        node_id: "end"
        input_from: "input"

    - source:
        node_id: "negative-response"
        output: "text"
      target:
        node_id: "end"
        input_from: "input"

dependencies:
  providers:
    - name: "anthropic"
      version: "1.0.0"
